(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{119:function(e,t,a){var r,n=t,i=a(0),o=a(46),l=a(149),u=a(1),s=a(3),c=a(9),m=a(23),g=a(40),h=a(22),v=a(87),f=a(18),p=a(7),d=a(32),F=a(13),y=a(8);n.GroupDetector=(r=function(){s.CoreObject.call(this)},i.defineClass({name:"GroupDetector",ctor:r,superName:"CoreObject",statics:{Y_DISTANCE_THRESHOLD:150,X_DISTANCE_THRESHOLD:0,splitFormaGroups:function(e,t){for(var a=0,n=i.iter(e);!n.done;n.next())a+=n.value.length;for(var o=e.concat();o.length<a&&o.length<t;){for(var l=-1,s=null,c=i.iter(i.range(0,o.length,!1));!c.done;c.next()){var m=c.value;if(o[m].length>1){var g=r.groupFrame(i.clone(o[m]));(null==s||g.area>s.area)&&(l=m,s=g)}}if(null==s){u.CoreAssert.fail("should have found a group to split");break}var h=r.splitGroup(i.clone(o[l])),v=h[0],f=h[1];o[l]=i.clone(v),o.splice(l+1,0,i.clone(f))}return o},groupFrame:function(e){if(0==e.length)return y.TheoRect.Zero;for(var t=e[0].finalFrame,a=i.iter(e);!a.done;a.next()){var r=a.value;t=t.unionWith(r.finalFrame)}return t},splitGroup:function(e){if(e.length<=1)return u.CoreAssert.fail("should have found a group to split"),[e,[]];for(var t=e[0].finalFrame,a=i.iter(e);!a.done;a.next()){var r=a.value;t=t.unionWith(r.finalFrame)}var n=t.origin,o=i.sort(e,function(e,t){return e.finalFrame.center.distanceTo(n)<t.finalFrame.center.distanceTo(n)}),l=[],s=[],c=0,m=o.length-1,g=o[c].finalFrame,h=o[m].finalFrame;for(l.push(o[c]),s.push(o[m]);c<m-1;){var v=g.area<h.area;o[c+1].finalFrame.intersects(g)&&(v=!0),o[m-1].finalFrame.intersects(h)&&(v=!1),v?(c+=1,l.push(o[c]),g=g.unionWith(o[c].finalFrame)):(m-=1,s.push(o[m]),h=h.unionWith(o[m].finalFrame))}return u.CoreAssert.isTrue(l.length+s.length==o.length,"counts don't match"),[l,s]},shareVisualParent:function(e,t){var a=r.getVisualParent(e).finalFrame,n=r.getVisualParent(t).finalFrame;return r.visualParentFramesOverlap(a,n)},visualParentFramesOverlap:function(e,t){var a;return!!(a=e.intersectionWith(t))&&a.area/Math.max(t.area,e.area)>.95},detectOverlapGroups:function(e){var t=[],a=i.sort(e,function(e,t){return e.finalFrame.area>t.finalFrame.area});if(a.length<=1)return t;for(var r=[],n=i.iter(i.range(0,a.length-1,!1));!n.done;n.next()){var o=n.value;if(!i.containsEq(r,a[o],c._equality_Forma_Forma)){for(var l=[a[o]],u=i.iter(i.range(o+1,a.length,!1));!u.done;u.next()){var s,m=u.value;(s=a[o].finalFrame.intersectionWith(a[m].finalFrame))&&!i.containsEq(r,a[m],c._equality_Forma_Forma)&&s.area/a[m].finalFrame.area>.5&&l.push(a[m])}if(l.length>1){for(var g=i.iter(l);!g.done;g.next()){var h=g.value;r.push(h)}t.push(i.clone(l))}}}for(var v=[],f=i.iter(t);!f.done;f.next()){var p=f.value,d=i.sort(p,function(e,t){var a,r;return null!=(a=i.opt(e.parent,function(t){return t.indexOfChild(e)}))&&null!=(r=i.opt(t.parent,function(e){return e.indexOfChild(t)}))&&a<r});v.push(i.clone(d))}return v},detectProximityGroups:function(e,t,a){void 0===t&&(t=null),void 0===a&&(a=!1);var n=null!=t?t:r.Y_DISTANCE_THRESHOLD,l=e.concat();i.sortInPlace(l,function(e,t){return e.finalFrame.center.distanceTo(F.TheoPoint.ZERO)<t.finalFrame.center.distanceTo(F.TheoPoint.ZERO)});var u,s=[],m=l.concat(),g=1,h=i.first(l);(u=i.opt(i.opt(h,function(e){return e.page.view}),function(e){return e.getViewportTransform()}))&&(g=Math.sqrt(Math.abs(u.determinant)));for(var v=o.AlignmentDetector.DISTANCE_THRESHOLD/g,f=i.iter(l);!f.done;f.next()){var p=f.value,d=o.AlignmentDetector.init_a05b(p),y=i.clone(d.detectFormaAlignments(v));if(i.containsEq(m,p,c._equality_Forma_Forma)){var C=[];C.push(p);var x=p.finalFrame;if(null==x)continue;for(var T=!0;T;){T=!1;for(var S=i.iter(m);!S.done;S.next()){var _,A=S.value;if(!i.eq(c._equality_Forma_Forma,A,p)&&(_=A.finalFrame)){var I=_.xDistance(x),D=_.yDistance(x),N=r.shareVisualParent(p,A)?n:50;if(a){for(var k=!1,b=i.iter(y);!b.done;b.next()){var w=b.value;i.eq(c._equality_Forma_Forma,w.forma,A)&&(k=!0)}if(!k)continue}D<=N&&I<=N&&(x=x.unionWith(_),T=!0,C.push(A))}}for(var P=i.iter(C);!P.done;P.next())A=P.value,i.remove(m,A)}s.push(i.clone(C))}}return s},shareVisualParent0:function(e,t){for(var a=i.clone(e.root.filterWithCallback(function(e){return e.isGraphic()})),r=null,n=null,o=e.finalFrame,l=t.finalFrame,u=i.iter(a);!u.done;u.next()){var s,m,g=u.value;g.kind==f.ImageForma.KIND||g.isDescendent(e)||g.isDescendent(t)||(s=g.finalFrame)&&((m=s.intersectionWith(o))&&m.area/o.area>.75&&(r=g),(m=s.intersectionWith(l))&&m.area/l.area>.75&&(n=g))}return i.eq(c._equality_Forma_Forma,r,n)},getVisualParent:function(e){var t=e.finalFrame;return r.getVisualParentHelper(e,t)},getGroupVisualParent:function(e){var t=e.childrenFinalFrame;return r.getVisualParentHelper(e,t)},getVisualParentHelper:function(e,t){for(var a=e.root,r=i.clone(e.root.filterWithCallback(function(t){var a=t.isDescendent(e);return!(i.eq(c._equality_Forma_Forma,t,e)||a||null==t.controller||t.controller.kind==v.ImageController.KIND||t.controller.kind==m.GridController.KIND||!t.isBackgroundImage()&&t.hasIntent(c.Forma.INTENT_ICON)&&t.kind!=d.RootForma.KIND&&t.controller.kind!=l.AlignmentGroupController.KIND)})),n=i.iter(r);!n.done;n.next()){var o,u=n.value;(o=u.finalFrame)&&o.contains(t)&&o.area<=a.finalFrame.area&&(a=u)}return a},detectVerticalAlignmentGroups:function(e){var t=[];if(0==e.length)return t;for(var a=e.concat();a.length>0;){var r,n=a[0],l=null,u=o.AlignmentDetector.init_a05b(n),s=[n];i.remove(a,n);for(var m=i.iter(u.detectFormaAlignments(o.AlignmentDetector.DISTANCE_THRESHOLD));!m.done;m.next()){var g=m.value;u.isVerticalAlignment(g.line.type)&&null!=g.forma&&i.containsEq(a,g.forma,c._equality_Forma_Forma)&&(l!=g.line.type&&null!=l||(l=g.line.type,i.containsEq(s,g.forma,c._equality_Forma_Forma)||(s.push(g.forma),i.remove(a,g.forma))))}null==l&&(l=null!=(r=i.opt(s[0].controller,function(e){return e.preferredXAlignment}))?r:o.AlignmentType.CenterX),t.push({alignment:l,formae:s})}return t},flattenInferredGroups:function(e){for(var t=i.iter(e.visitAsArray(c.FormaTraversal.JustChildren));!t.done;t.next()){var a=t.value;if(a.hasIntent(c.Forma.INTENT_INFERRED_TEMP_GROUP)){for(var r=i.iter(a.visitAsArray(c.FormaTraversal.JustChildren));!r.done;r.next()){var n=r.value;e.appendChild(n,!0)}a.removeFromParent(),i.opt(i.as(e.controller,m.GridController),function(e){return e.inferGridCellAssignment()})}}},inferVisualParentGroup:function(e,t){for(var a=t.finalFrame,r=i.clone(e.filterWithCallback(function(e){return null!=e.controller&&e.controller.floating},c.FormaTraversal.JustChildren)),n=[],o=i.iter(r);!o.done;o.next()){var l,u,s=o.value;i.eq(c._equality_Forma_Forma,s,t)||(l=s.finalFrame)&&(u=a.intersectionWith(l))&&u.area/l.area>.75&&n.push(s)}if(n.length>0){var m=t.page.createFormaWithController(h.GroupForma.KIND,g.GroupController.KIND);m.allowUserMove=!0,m.intent=c.Forma.INTENT_INFERRED_TEMP_GROUP,e.appendChild(m),m.placement=p.Matrix2D.translationXY(a.minX,a.minY),m.bounds=y.TheoRect.fromSize(a.size);for(var v=i.iter(n);!v.done;v.next()){var f=v.value;m.appendChild(f,!0)}return m}return null},createOverlapGroups:function(e){for(var t=i.clone(e.filterWithCallback(function(e){return null!=e.controller&&e.controller.floating&&!e.hasIntent(c.Forma.INTENT_INFERRED_TEMP_GROUP)},c.FormaTraversal.JustChildren)),a=[],n=i.iter(r.detectOverlapGroups(i.clone(t)));!n.done;n.next()){var o=n.value,l=e.page.createFormaWithController(h.GroupForma.KIND,g.GroupController.KIND);l.allowUserMove=!0,l.intent=c.Forma.INTENT_INFERRED_TEMP_GROUP,e.appendChild(l);for(var u=o[0].frame,s=i.iter(o);!s.done;s.next()){var m=s.value;u=u.unionWith(m.frame)}var v=u;l.placement=p.Matrix2D.translationXY(v.minX,v.minY),l.bounds=y.TheoRect.fromSize(v.size);for(var f=i.iter(o);!f.done;f.next())m=f.value,l.appendChild(m,!0);a.push(l)}return a},inferVisualGroups:function(e){return[]}}}),r)},227:function(e,t,a){var r,n=t,i=a(0),o=a(1),l=a(9),u=a(24),s=a(91),c=a(27),m=a(113),g=a(237),h=a(12),v=a(13),f=a(8),p=a(26);n.GridStyleFeatureExtractor=(r=function(e,t,a,r,n){var l;if(this.imageCells_=[],this.floatingCells_=[],this.adjacentImageCount_=0,this.cellXSymm_=0,this.cellYSymm_=0,void 0===e&&(e=null),void 0===t&&(t=null),void 0===a&&(a=null),void 0===r&&(r=null),void 0===n&&(n=[]),o.CoreAssert.isTrue(null!=t||null!=i.as(i.opt(e,function(e){return e.style}),m.GridStyle)),this.gridStyle_=t||e.style,this.gridFrame_=a||e.frame,this.gridCells_=i.clone(this.gridStyle_.gridCellArray),null!=r)this.layoutItems_=i.clone(r);else if(this.layoutItems_=[],l=e)for(var u=i.clone(l.filterWithCallback(function(e){return null!=e.controller&&e.controller.floating||e.isBackgroundImage()})),c=i.iter(u);!c.done;c.next()){var h=c.value;this.layoutItems_.push(g.LayoutItem.init_b14a(h))}this.currentGrid_=e,this.forFeatures_=i.clone(n),this.featureEvals_=[],s.FeatureExtractor.call(this),this.imageCells_=i.clone(this.getTypeOfCell(g.ItemContentType.Image)),this.floatingCells_=i.clone(this.getTypeOfCell(g.ItemContentType.Floating)),this.adjacentImageCount_=0;for(var v=i.iter(this.imageCells_);!v.done;v.next())for(var f=v.value,p=i.iter(this.imageCells_);!p.done;p.next()){var d=p.value;this.isAdjacent(f,d)&&f!==d&&(this.adjacentImageCount_+=1)}this.cellXSymm_=this.getCellSymmAsymm(!0),this.cellYSymm_=this.getCellSymmAsymm(!1),this.initFeatures(),this.evaluateFeatures()},i.defineClass({name:"GridStyleFeatureExtractor",ctor:r,superName:"FeatureExtractor",statics:{_implements:function(e){return"FeatureExtractorProtocol"==e}},props:{initFeatures:function(){this.featureEvals_=[["CellAspectRatio",[this.evaluateCellAspectRatio,s.FeatureType.Numerical]],["AreaPercentImages",[this.evaluateAreaPercentImages,s.FeatureType.Numerical]],["ImageCellContentFit",[this.evaluateImageCellContentFit,s.FeatureType.Numerical]],["AverageCellSize",[this.evaluateAverageCellSize,s.FeatureType.Numerical]],["AverageImageCellSize",[this.evaluateAverageImageCellSize,s.FeatureType.Numerical]],["AverageTextCellSize",[this.evaluateAverageTextCellSize,s.FeatureType.Numerical]],["ImageCellVariance",[this.evaluateImageCellVariance,s.FeatureType.Numerical]],["TextCellVariance",[this.evaluateTextCellVariance,s.FeatureType.Numerical]],["OverallCellVariance",[this.evaluateOverallCellVariance,s.FeatureType.Numerical]],["TypeSymmetryAcrosstheXAxis",[this.evaluateXAxisTypeSymmetry,s.FeatureType.Numerical]],["TypeSymmetryAcrosstheYAxis",[this.evaluateYAxisTypeSymmetry,s.FeatureType.Numerical]],["TypeAsymmetryAcrosstheXAxis",[this.evaluateXAxisTypeAsymmetry,s.FeatureType.Numerical]],["TypeAsymmetryAcrosstheYAxis",[this.evaluateYAxisTypeAsymmetry,s.FeatureType.Numerical]],["CellSymmetryAcrosstheXAxis",[this.evaluateXAxisCellSymmetry,s.FeatureType.Numerical]],["CellSymmetryAcrosstheYAxis",[this.evaluateYAxisCellAsymmetry,s.FeatureType.Numerical]],["CellAsymmetryAcrosstheXAxis",[this.evaluateXAxisCellSymmetry,s.FeatureType.Numerical]],["CellAsymmetryAcrosstheYAxis",[this.evaluateYAxisCellAsymmetry,s.FeatureType.Numerical]],["AverageImageXVal",[this.evaluateAverageImageXVal,s.FeatureType.Numerical]],["AverageImageYVal",[this.evaluateAverageImageYVal,s.FeatureType.Numerical]],["AverageTextXVal",[this.evaluateAverageTextXVal,s.FeatureType.Numerical]],["AverageTextYVal",[this.evaluateAverageTextYVal,s.FeatureType.Numerical]],["ImageSpreadinXDimension",[this.evaluateImageXSpread,s.FeatureType.Numerical]],["ImageSpreadinYDimension",[this.evaluateImageYSpread,s.FeatureType.Numerical]],["TextSpreadinXDimension",[this.evaluateTextXSpread,s.FeatureType.Numerical]],["TextSpreadinYDimension",[this.evaluateTextYSpread,s.FeatureType.Numerical]],["MaxImageXOffsetFromCenter",[this.evaluateMaxImageXOffsetFromCenter,s.FeatureType.Numerical]],["MaxImageYOffsetFromCenter",[this.evaluateMaxImageYOffsetFromCenter,s.FeatureType.Numerical]],["MaxTextXOffsetFromCenter",[this.evaluateMaxTextXOffsetFromCenter,s.FeatureType.Numerical]],["MaxTextYOffsetFromCenter",[this.evaluateMaxTextYOffsetFromCenter,s.FeatureType.Numerical]],["TextFocused",[this.evaluateTextFocused,s.FeatureType.Numerical]],["TextDispersement",[this.evaluateTextDispersement,s.FeatureType.Numerical]],["AdjacentMatches",[this.evaluateAdjacentMatch,s.FeatureType.Numerical]],["AdjacentMismatches",[this.evaluateAdjacentMismatch,s.FeatureType.Numerical]],["PreviousOrder",[this.evaluatePreviousOrder,s.FeatureType.Numerical]],["PreviousPosition",[this.evaluatePreviousPosition,s.FeatureType.Numerical]],["PreviousPositionFlip",[this.evaluatePreviousPositionFlip,s.FeatureType.Numerical]],["PreviousImageSize",[this.evaluatePreviousImageSize,s.FeatureType.Numerical]]]},evaluateFeatures:function(){for(var e=0==this.forFeatures_.length,t=i.iter(this.featureEvals_);!t.done;t.next()){var a=t.value;if(e||!e&&this.forFeatures_.includes(a[0])){var r=a[1],n=(0,r[0])(this);this.setFeature(a[0],n,r[1])}}},evaluateCellAspectRatio:function(e){for(var t=0,a=i.iter(e.gridCells_);!a.done;a.next()){var r=a.value,n=e.gridFrame_.evalRect(r.bounds),l=Math.max(n.aspectRatio,1/n.aspectRatio);o.CoreAssert.isTrue(l>0),t+=l}return t/i.toDouble(e.gridCells_.length)},evaluateImageCellContentFit:function(e){for(var t=0,a=0,r=i.iter(e.layoutItems_);!r.done;r.next()){var n,o,l,u=r.value;if(u.type==g.ItemContentType.Image&&(n=i.opt(e.gridStyle_.formaMapping[u.id],function(e){return e.bounds}))&&null!=(o=u.width)&&null!=(l=u.height)){var s=e.gridFrame_.evalRect(n),c=f.TheoRect.fromSize(new p.TheoSize(i.toDouble(o),i.toDouble(l)));t+=s.similarity(c),a+=1}}return t/(i.toDouble(a)+1e-5)},evaluateAreaPercentImages:function(e){return e.getCellAreaSum(i.clone(e.getImageCells()))/e.gridFrame_.area},evaluateAverageCellSize:function(e){return 1/i.toDouble(e.gridCells_.length)},evaluateAverageImageCellSize:function(e){var t=i.clone(e.getImageCells());return 0!=t.length?e.getCellAreaSum(i.clone(t))/i.toDouble(t.length)/e.gridFrame_.area:0},evaluateAverageTextCellSize:function(e){var t=i.clone(e.getFloatingCells());return 0!=t.length?e.getCellAreaSum(i.clone(t))/i.toDouble(t.length)/e.gridFrame_.area:0},evaluateImageCellVariance:function(e){return e.getVariance(i.clone(e.getImageCells()))},evaluateTextCellVariance:function(e){return e.getVariance(i.clone(e.getFloatingCells()))},evaluateOverallCellVariance:function(e){var t=i.clone(e.getFloatingCells()),a=i.clone(e.getImageCells()),r=e.getMaxandMinCellArea(i.clone(a)),n=r[0],o=r[1],l=e.getMaxandMinCellArea(i.clone(t)),u=l[0],s=l[1],c=Math.max(n,u),m=Math.min(o,s);return Math.abs((c-m)/e.gridFrame_.area)},evaluateXAxisTypeSymmetry:function(e){return e.getSymmAsymm(i.clone(e.getImageCells()),i.clone(e.getImageCells()),!0,1)},evaluateYAxisTypeSymmetry:function(e){return e.getSymmAsymm(i.clone(e.getImageCells()),i.clone(e.getImageCells()),!1,1)},evaluateXAxisTypeAsymmetry:function(e){return 2*e.getSymmAsymm(i.clone(e.getImageCells()),i.clone(e.getFloatingCells()),!0,0)},evaluateYAxisTypeAsymmetry:function(e){return 2*e.getSymmAsymm(i.clone(e.getImageCells()),i.clone(e.getFloatingCells()),!1,0)},evaluateXAxisCellSymmetry:function(e){return e.cellXSymm_},evaluateYAxisCellSymmetry:function(e){return e.cellYSymm_},evaluateXAxisCellAsymmetry:function(e){return 1-e.cellXSymm_},evaluateYAxisCellAsymmetry:function(e){return 1-e.cellYSymm_},evaluateAverageImageXVal:function(e){return e.getAverageVal(i.clone(e.getImageCells()),!0)},evaluateAverageImageYVal:function(e){return e.getAverageVal(i.clone(e.getImageCells()),!1)},evaluateAverageTextXVal:function(e){return e.getAverageVal(i.clone(e.getFloatingCells()),!0)},evaluateAverageTextYVal:function(e){return e.getAverageVal(i.clone(e.getFloatingCells()),!1)},evaluateImageXSpread:function(e){return e.getSpread(i.clone(e.getImageCells()),!0)},evaluateImageYSpread:function(e){return e.getSpread(i.clone(e.getImageCells()),!1)},evaluateTextXSpread:function(e){return e.getSpread(i.clone(e.getFloatingCells()),!0)},evaluateTextYSpread:function(e){return e.getSpread(i.clone(e.getFloatingCells()),!1)},evaluateMaxImageXOffsetFromCenter:function(e){return e.getOffsetFromCenter(i.clone(e.getImageCells()),!0)},evaluateMaxImageYOffsetFromCenter:function(e){return e.getOffsetFromCenter(i.clone(e.getImageCells()),!1)},evaluateMaxTextXOffsetFromCenter:function(e){return e.getOffsetFromCenter(i.clone(e.getFloatingCells()),!0)},evaluateMaxTextYOffsetFromCenter:function(e){return e.getOffsetFromCenter(i.clone(e.getFloatingCells()),!1)},evaluateTextFocused:function(e){var t=i.clone(e.getFloatingCells());return 1==t.length&&e.gridFrame_.area>0?t[0].bounds.area/e.gridFrame_.area:0},evaluateTextDispersement:function(e){for(var t=i.clone(e.getFloatingCells()),a=0,r=i.iter(e.layoutItems_);!r.done;r.next()){var n=r.value;null!=e.gridStyle_.formaMapping[n.id]&&n.type==g.ItemContentType.Floating&&(a+=1)}return i.toDouble(t.length)/(a+.001)},evaluateAdjacentMatch:function(e){for(var t=0,a=0,r=i.clone(e.getFloatingCells()),n=i.clone(e.getImageCells()),o=i.iter(r);!o.done;o.next())for(var l=o.value,u=i.iter(r);!u.done;u.next()){for(var s=u.value,c=i.iter(n);!c.done;c.next()){var m=c.value;e.isAdjacent(l,m)&&(a+=1)}e.isAdjacent(l,s)&&l!==s&&(t+=1,a+=1)}return a+=e.adjacentImageCount_,t+=e.adjacentImageCount_,a>0?i.toDouble(t)/i.toDouble(a):0},evaluateAdjacentMismatch:function(e){for(var t=0,a=0,r=i.clone(e.getFloatingCells()),n=i.clone(e.getImageCells()),o=i.iter(r);!o.done;o.next())for(var l=o.value,u=i.iter(r);!u.done;u.next()){for(var s=u.value,c=i.iter(n);!c.done;c.next()){var m=c.value;e.isAdjacent(l,m)&&(a+=1,t+=1)}e.isAdjacent(l,s)&&l!==s&&(a+=1)}return(a+=e.adjacentImageCount_)>0?i.toDouble(t)/i.toDouble(a):0},evaluatePreviousPosition:function(e){return e.getPreviousPos(!1)},evaluatePreviousPositionFlip:function(e){return e.getPreviousPos(!0)},evaluatePreviousImageSize:function(e){var t;if(t=e.currentGrid_){for(var a=t.root,r=0,n={},o=i.iter(i.keys(e.gridStyle_.formaMapping));!o.done;o.next()){var l=o.value;n[l]=e.gridStyle_.formaMapping[l]}for(var u=i.iter(n);!u.done;u.next()){var s,c=u.key,m=u.value,g=i.opt(a,function(e){return e.formaByID(c)});if(null!=g&&(s=g.finalFrame)){var h=a.finalFrame.size,v=i.opt(t.finalFrame,function(e){return e.evalRect(m.bounds)});g.isImage()&&null!=v&&(r+=Math.abs(s.area-v.area)/(h.width*h.height))}}return r}return 0},evaluatePreviousOrder:function(e){var t;if(t=e.currentGrid_){for(var a=t.root,r=[],n=[],o=i.clone(e.getImageCells()),s=i.clone(e.getFloatingCells()),m=[],g=i.iter(i.range(0,e.gridCells_.length,!1));!g.done;g.next())m.push(null);for(var f={},p=i.iter(i.keys(e.gridStyle_.formaMapping));!p.done;p.next()){var d=p.value;f[d]=e.gridStyle_.formaMapping[d]}for(var F=i.iter(f);!F.done;F.next()){var y=F.key,C=F.value,x=i.opt(a,function(e){return e.formaByID(y)});i.opt(i.opt(x,function(e){return e.controller}),function(e){return e.kind==u.FrameController.KIND})&&(o.includes(C)||o.push(C),r.push({cell:C,forma:x})),i.opt(i.opt(x,function(e){return e.controller}),function(e){return e.kind==h.TypeLockupController.KIND})&&(s.includes(C)||s.push(C),n.push({cell:C,forma:x}))}var T=i.clone(t.root.filterByKind(c.FrameForma.KIND));i.sortInPlace(T,function(e,t){return e.frame.center.distanceTo(v.TheoPoint.ZERO)<t.frame.center.distanceTo(v.TheoPoint.ZERO)}),i.sortInPlace(r,function(e,t){return e.cell.bounds.origin.distanceTo(v.TheoPoint.ZERO)<t.cell.bounds.origin.distanceTo(v.TheoPoint.ZERO)});var S=i.clone(t.root.filterByControllerKind(h.TypeLockupController.KIND));i.sortInPlace(S,function(e,t){return e.frame.center.distanceTo(v.TheoPoint.ZERO)<t.frame.center.distanceTo(v.TheoPoint.ZERO)}),i.sortInPlace(s,function(e,t){return e.bounds.center.distanceTo(v.TheoPoint.ZERO)<t.bounds.center.distanceTo(v.TheoPoint.ZERO)});for(var _=0,A=i.iter(i.range(0,r.length,!1));!A.done;A.next()){var I=r[X=A.value].forma;null!=(O=i.indexOfEq(T,I,l._equality_Forma_Forma))&&O!=X&&(_+=1)}for(var D=[],N=i.iter(s);!N.done;N.next()){for(var k=N.value,b=[],w=i.iter(n);!w.done;w.next()){var P=w.value;P.cell==k&&b.push(P.forma)}i.sortInPlace(b,function(e,t){return e.finalFrame.origin.distanceTo(v.TheoPoint.ZERO)<t.finalFrame.origin.distanceTo(v.TheoPoint.ZERO)}),i.append(D,b)}for(var E=i.iter(i.range(0,D.length,!1));!E.done;E.next()){var X,O,Y=D[X=E.value];null!=(O=i.indexOfEq(S,Y,l._equality_Forma_Forma))&&O!=X&&(_+=1)}return _}return 0},getPreviousPos:function(e){var t;if(t=this.currentGrid_){for(var a=t.root,r=0,n={},l=i.iter(i.keys(this.gridStyle_.formaMapping));!l.done;l.next()){var u=l.value;n[u]=this.gridStyle_.formaMapping[u]}for(var s=i.iter(n);!s.done;s.next()){var c,m=s.key,g=s.value,h=i.opt(a,function(e){return e.formaByID(m)});if(null!=h&&(c=h.finalFrame)){var f=a.finalFrame.size;o.CoreAssert.isTrue(f.width>0&&f.height>0),r+=(e?new v.TheoPoint(c.center.y/f.height,c.center.x/f.width):new v.TheoPoint(c.center.x/f.width,c.center.y/f.height)).distanceTo(g.bounds.center)}}return r}return 0},getSymmAsymm:function(e,t,a,r){var n;void 0===r&&(r=0);var o=0;if(0==t.length||0==e.length)return r;for(var l=i.iter(i.range(0,e.length,!1));!l.done;l.next())for(var u=e[l.value].bounds,s=a?new f.TheoRect(u.minX,1-u.maxY,u.maxX,1-u.minY):new f.TheoRect(1-u.maxX,u.minY,1-u.minX,u.maxY),c=i.iter(i.range(0,t.length,!1));!c.done;c.next()){var m=c.value,g=this.cellIntersection(t[m].bounds,s);o+=(n=i.opt(g,function(e){return e.area}))||null!=n?n:0}return e.length>0?o:r},getCellSymmAsymm:function(e){for(var t,a=0,r=i.iter(i.range(0,this.gridCells_.length,!1));!r.done;r.next())for(var n=r.value,o=this.gridCells_[n].bounds,l=e?new f.TheoRect(o.minX,1-o.maxY,o.maxX,1-o.minY):new f.TheoRect(1-o.maxX,o.minY,1-o.minX,o.maxY),u=i.iter(i.range(0,this.gridCells_.length,!1));!u.done;u.next()){var s=u.value,c=this.gridCells_[s].bounds,m=this.cellIntersection(c,l);a+=((t=i.opt(m,function(e){return e.area}))||null!=t?t:0)/Math.max(o.area,c.area)}return this.gridCells_.length>0?a/i.toDouble(this.gridCells_.length):0},cellIntersection:function(e,t){var a=null;return Math.max(e.minX,t.minX)<Math.min(e.maxX,t.maxX)&&Math.max(e.minY,t.minY)<Math.min(e.maxY,t.maxY)&&(a=new f.TheoRect(Math.max(e.minX,t.minX),Math.max(e.minY,t.minY),Math.min(e.maxX,t.maxX),Math.min(e.maxY,t.maxY))),a},isAdjacent:function(e,t){var a=e.bounds,r=t.bounds;return a.maxX-r.minX>0&&r.maxX-a.minX>0&&a.maxY-r.minY>=0&&r.maxY-a.minY>=0||a.maxX-r.minX>=0&&r.maxX-a.minX>=0&&a.maxY-r.minY>0&&r.maxY-a.minY>0},getOffsetFromCenter:function(e,t){for(var a=0,r=i.iter(e);!r.done;r.next()){var n=r.value,o=Math.abs((t?n.bounds.center.x:n.bounds.center.y)-.5);o>a&&(a=o)}return a},getAverageVal:function(e,t){for(var a=0,r=i.iter(e);!r.done;r.next()){var n=r.value;a+=t?n.bounds.center.x:n.bounds.center.y}return e.length>0?a/i.toDouble(e.length):0},getSpread:function(e,t){for(var a=1,r=0,n=i.iter(e);!n.done;n.next()){var o=n.value;t?(o.bounds.minX<a&&(a=o.bounds.minX),o.bounds.maxX>r&&(r=o.bounds.maxX)):(o.bounds.minY<a&&(a=o.bounds.minY),o.bounds.maxY>r&&(r=o.bounds.maxY))}return Math.max(r-a,0)},getVariance:function(e){var t=this.getMaxandMinCellArea(i.clone(e)),a=t[0],r=t[1];return Math.abs((a-r)/this.gridFrame_.area)},getMaxandMinCellArea:function(e){for(var t=0,a=this.gridFrame_.area,r=i.iter(e);!r.done;r.next()){var n=r.value,o=this.gridFrame_.evalRect(n.bounds).area;o>t&&(t=o),o<a&&(a=o)}return[t,a]},getCellAreaSum:function(e){for(var t=0,a=i.iter(e);!a.done;a.next()){var r=a.value;t+=this.gridFrame_.evalRect(r.bounds).area}return t},getImageCells:function(){return this.imageCells_},getFloatingCells:function(){return this.floatingCells_},getTypeOfCell:function(e){for(var t=[],a=i.iter(this.layoutItems_);!a.done;a.next()){var r,n=a.value;(r=this.gridStyle_.formaMapping[n.id])&&n.type==e&&(t.includes(r)||t.push(r))}return t}}}),r)},304:function(e,t,a){var r,n=t,i=a(0),o=a(3);n.ModelWeightLibrary=(r=function(){o.CoreObject.call(this)},i.defineClass({name:"ModelWeightLibrary",ctor:r,superName:"CoreObject",statics:{weights:{DefaultDesignScore:{Maxzoomlevel:{mean:.00018027334267821125,std:.8132335406308514,weight:-.08010375273536166},textareanotcontrasting:{mean:-.0033339994317995274,std:.25020875502904477,weight:-.14415975362288352},shapesareanotcontrasting:{mean:-.0005424908444142923,std:.16815414319793917,weight:-.030270956800708296},lockupareaoutofbounds:{mean:.0003963054774770136,std:.03879175427738692,weight:-.1289655276464355},minfontsize:{mean:.4162329663731091,std:27.695820940950014,weight:.04372203001144579},maxfontsize:{mean:.4612274707747426,std:57.444985900183354,weight:.10830759811249395},mintextarea:{mean:488.9105104765153,std:89533.71385858732,weight:-.013866098359443309},maxtextarea:{mean:1325.1752065666267,std:186711.01621053327,weight:-.2361503759042213},minshapesize:{mean:-55.646916071109146,std:44574.83972690322,weight:.029270742827542353},maxshapesize:{mean:-201.25488977770246,std:46340.96127095905,weight:-.08223116203941933},lockupareaoverlapping:{mean:.00020290565299043752,std:.03925994410311496,weight:-.1636881423600194},Maxemptyspace:{mean:-.004717028998489912,std:.1976916685529546,weight:-.11662298994579136},textincorrectalign:{mean:-.004764058495477163,std:.2987539130553497,weight:-.03690998410689036},emptygridsquares:{mean:-.0007268850555160692,std:.14877245350943186,weight:-.23283917900645912},overlappingmultiplegridcells:{mean:-.008452699670100044,std:.4087079047503421,weight:-.0569178307172981},maxaspectratio:{mean:.021926589002448465,std:3.1432119741395548,weight:.21439804312559388},breakingflowX:{mean:-.006980250264133872,std:.45684350428459336,weight:.011093192112083617},breakingflowY:{mean:-.008525554047037538,std:.4077234799494897,weight:-.06308947475173525},BreakingHorisontalSymmetryinsidevisualparent:{mean:412041.9613712293,std:45212121.039130844,weight:-.034310695376294276},marginsaretoosmall:{mean:-32649.714698565716,std:4443401.694947285,weight:-.028229129254167384},balanceofvisualparentX:{mean:-.007559473558332495,std:.3227787688513554,weight:-.13312017596904124},balanceofvisualparentY:{mean:-.010450324811186476,std:.4524201239517186,weight:-.09532942482280946},totalalignmentlines:{mean:-.0009045680687471732,std:.5654767847212782,weight:.007683119790124987},CellAspectRatio:{mean:-.000866027015147402,std:1.4808460165726252,weight:-.2282126421778498},AreaPercentImages:{mean:.0011783622381679377,std:.3209991901820274,weight:.40897766247230655},ImageCellContentFit:{mean:-.0010022863121065778,std:.06839864851764367,weight:-.035663159273769146},AverageCellSize:{mean:-.003853477920843118,std:.3674675336869799,weight:-.0861206668785603},AverageImageCellSize:{mean:.0014705706334928255,std:.30689611738107436,weight:-.310870215199779},AverageTextCellSize:{mean:.0030857846907960075,std:.3190234573570835,weight:.03296304542028719},ImageCellVariance:{mean:.0008047901252859525,std:.06410991367658431,weight:-.024296079984680582},TextCellVariance:{mean:.0036032703466117107,std:.14545169804975572,weight:.08747903039684307},OverallCellVariance:{mean:.010513688422152926,std:.3036485447684895,weight:.006791166993508748},TypeSymmetryAcrosstheXAxis:{mean:.0025981146277427093,std:.43849102556669445,weight:-.2902662035011975},TypeSymmetryAcrosstheYAxis:{mean:-.0007791864813152262,std:.45283696286437347,weight:-.23419662370595393},TypeAsymmetryAcrosstheXAxis:{mean:.008912652724408086,std:.7331157676033474,weight:-.09727780755199468},TypeAsymmetryAcrosstheYAxis:{mean:.010873023708513306,std:.6982196294438795,weight:.03350849616250007},CellSymmetryAcrosstheXAxis:{mean:-.001132162147191269,std:.33392704164452364,weight:.06266679976903884},CellSymmetryAcrosstheYAxis:{mean:-.0005155668142621847,std:.33292297327240367,weight:-.058041551211506504},CellAsymmetryAcrosstheXAxis:{mean:.001132162147191268,std:.33392704164452364,weight:-.06266679976903927},CellAsymmetryAcrosstheYAxis:{mean:.0005155668139908147,std:.3329229732722636,weight:.058041551397742044},AverageImageXVal:{mean:-.0015815559988986917,std:.15008002059800904,weight:-.06098982378772082},AverageImageYVal:{mean:7891179554016043e-20,std:.1438772538377358,weight:-.10273553740768389},AverageTextXVal:{mean:.0049443186134623075,std:.25262901903129675,weight:-.025304213039208205},AverageTextYVal:{mean:.004664303074648295,std:.26747263439055524,weight:.012656120935728677},ImageSpreadinXDimension:{mean:-.00310888031836687,std:.28336827022361394,weight:.24726198560445092},ImageSpreadinYDimension:{mean:.0031367634820247538,std:.27346012927936375,weight:.1989040843352687},TextSpreadinXDimension:{mean:.00650620828022051,std:.4043232862187427,weight:-.1293283969219272},TextSpreadinYDimension:{mean:.007645995665318362,std:.40379994376989187,weight:-.011516607422389176},MaxImageXOffsetFromCenter:{mean:.0016157427991856622,std:.14246903105574066,weight:-.020089296400970874},MaxImageYOffsetFromCenter:{mean:-.0008679463633771875,std:.12934639704481982,weight:-.15444476815025124},MaxTextXOffsetFromCenter:{mean:.0007758562872193546,std:.10612718654583783,weight:-.08563320326004221},MaxTextYOffsetFromCenter:{mean:.0025601067703762033,std:.14804047677121857,weight:.0002795079579061673},TextFocused:{mean:1.1008033251432315e-9,std:3.747646504742835e-7,weight:.011466692333776875},TextDispersement:{mean:.006047062110539865,std:.38381427709455296,weight:.025895655099346427},AdjacentMatches:{mean:.001957343375687507,std:.24482209931437043,weight:-.021211802454498736},AdjacentMismatches:{mean:.005279201174289879,std:.4373270531182902,weight:.0011997430973767964},PreviousOrder:{mean:-.004296698326549073,std:.7698699665723179,weight:-.004121330693776555},PreviousPosition:{mean:.0040594447624014525,std:.4015754424391129,weight:.02671704069247397},PreviousPositionFlip:{mean:.009238177093947593,std:1.072273993426883,weight:.14746380228860045}},DefaultGridScore:{CellAspectRatio:{mean:0,std:1,weight:-.571428571428571},AreaPercentImages:{mean:0,std:1,weight:.3},ImageCellContentFit:{mean:0,std:1,weight:-10},AverageCellSize:{mean:0,std:1,weight:.4},AverageImageCellSize:{mean:0,std:1,weight:.3},AverageTextCellSize:{mean:0,std:1,weight:.2},ImageCellVariance:{mean:0,std:1,weight:-.7},TextCellVariance:{mean:0,std:1,weight:-.7},OverallCellVariance:{mean:0,std:1,weight:0},TypeSymmetryAcrosstheXAxis:{mean:0,std:1,weight:1.42857142857143},TypeSymmetryAcrosstheYAxis:{mean:0,std:1,weight:1.42857142857143},TypeAsymmetryAcrosstheXAxis:{mean:0,std:1,weight:-1.42857142857143},TypeAsymmetryAcrosstheYAxis:{mean:0,std:1,weight:-1.42857142857143},CellSymmetryAcrosstheXAxis:{mean:0,std:1,weight:.285714285714286},CellSymmetryAcrosstheYAxis:{mean:0,std:1,weight:.285714285714286},CellAsymmetryAcrosstheXAxis:{mean:0,std:1,weight:-.285714285714286},CellAsymmetryAcrosstheYAxis:{mean:0,std:1,weight:-.285714285714286},AverageImageXVal:{mean:0,std:1,weight:0},AverageImageYVal:{mean:0,std:1,weight:0},AverageTextXVal:{mean:0,std:1,weight:0},AverageTextYVal:{mean:0,std:1,weight:0},ImageSpreadinXDimension:{mean:0,std:1,weight:.571428571428571},ImageSpreadinYDimension:{mean:0,std:1,weight:.571428571428571},TextSpreadinXDimension:{mean:0,std:1,weight:.571428571428571},TextSpreadinYDimension:{mean:0,std:1,weight:.571428571428571},MaxImageXOffsetFromCenter:{mean:0,std:1,weight:0},MaxImageYOffsetFromCenter:{mean:0,std:1,weight:0},MaxTextXOffsetFromCenter:{mean:0,std:1,weight:0},MaxTextYOffsetFromCenter:{mean:0,std:1,weight:0},TextFocused:{mean:0,std:1,weight:.142857142857143},TextDispersement:{mean:0,std:1,weight:1.17142857142857},AdjacentMatches:{mean:0,std:1,weight:-2.85714285714286},AdjacentMismatches:{mean:0,std:1,weight:2.85714285714286},PreviousOrder:{mean:0,std:1,weight:-1},PreviousPosition:{mean:0,std:1,weight:-1},PreviousPositionFlip:{mean:0,std:1,weight:-.5},PreviousImageSize:{mean:0,std:1,weight:-10}}},getData:function(e,t){return i.keys(r.weights).includes(e)&&i.keys(r.weights[e]).includes(t)?r.weights[e][t]:{mean:0,std:1,weight:0}}}}),r)},420:function(e,t,a){var r,n=t,i=a(0),o=a(17),l=a(134),u=a(24),s=a(91),c=a(23),m=a(18),g=a(16),h=a(32),v=a(28),f=a(12);n.DesignStyleFeatureExtractor=(r=function(e,t){void 0===t&&(t=[]),this.root_=e,this.forFeatures_=i.clone(t),this.featureEvals_=[],s.FeatureExtractor.call(this),this.initFeatures(),this.evaluateFeatures()},i.defineClass({name:"DesignStyleFeatureExtractor",ctor:r,superName:"FeatureExtractor",statics:{_implements:function(e){return"FeatureExtractorProtocol"==e}},props:{initFeatures:function(){this.featureEvals_=[["TextSymmetryX",[this.evaluateTextXSymmetry,s.FeatureType.Numerical]],["TextSymmetryY",[this.evaluateTextYSymmetry,s.FeatureType.Numerical]],["Whitespace",[this.evaluateWhiteSpace,s.FeatureType.Numerical]],["DesignAngle",[this.evaluateDesignAngle,s.FeatureType.Numerical]],["TextDesignCoverage",[this.evaluateTextDesignCoverage,s.FeatureType.Numerical]],["ImageDesignCoverage",[this.evaluateImageDesignCoverage,s.FeatureType.Numerical]],["ShapeDesignCoverage",[this.evaluateShapeDesignCoverage,s.FeatureType.Numerical]],["TextCount",[this.evaluateTextCount,s.FeatureType.Numerical]],["ImageCount",[this.evaluateImageCount,s.FeatureType.Numerical]],["ShapeCount",[this.evaluateShapeCount,s.FeatureType.Numerical]],["LogoCount",[this.evaluateLogoCount,s.FeatureType.Numerical]],["SalientCoverage",[this.evaluateSalientCoverage,s.FeatureType.Numerical]],["MarginSpace",[this.evaluateMarginSpace,s.FeatureType.Numerical]],["TextFonts",[this.evaluateFonts,s.FeatureType.Complex]],["TextShapes",[this.evaluateTextShapes,s.FeatureType.Complex]],["DesignColors",[this.evaluateColors,s.FeatureType.Complex]],["BackgroundTypes",[this.evaluateBackgroundTypes,s.FeatureType.Complex]],["GridCount",[this.evaluateGridCount,s.FeatureType.Numerical]],["PageHeight",[this.evaluatePageHeight,s.FeatureType.Numerical]],["PageWidth",[this.evaluatePageWidth,s.FeatureType.Numerical]],["BackgroundImageCount",[this.evaluateBackgroundImageCount,s.FeatureType.Numerical]],["ForegroundImageCount",[this.evaluateForegroundImageCount,s.FeatureType.Numerical]],["VisualGroupInfo",[this.evaluateVisualGroupInfo,s.FeatureType.Numerical]]]},evaluateFeatures:function(){for(var e=0==this.forFeatures_.length,t=i.iter(this.featureEvals_);!t.done;t.next()){var a=t.value;if(e||!e&&this.forFeatures_.includes(a[0])){var r=a[1],n=(0,r[0])(this);this.setFeature(a[0],n,r[1])}}},evaluateTextXSymmetry:function(e){var t=i.clone(e.root_.filterByControllerKind(f.TypeLockupController.KIND));return l.DesignFeatureUtils.getSymmAsymmForForma(i.clone(t),!0)},evaluateTextYSymmetry:function(e){var t=i.clone(e.root_.filterByControllerKind(f.TypeLockupController.KIND));return l.DesignFeatureUtils.getSymmAsymmForForma(i.clone(t),!1)},evaluateWhiteSpace:function(e){return l.DesignFeatureUtils.evaluateRootEmptySpace(e.root_)},evaluateDesignAngle:function(e){return e.root_.page.pageSize.angle},evaluateTextDesignCoverage:function(e){return l.DesignFeatureUtils.sumAreaOfForma(i.clone(e.root_.filterByControllerKind(f.TypeLockupController.KIND)),e.root_)},evaluateImageDesignCoverage:function(e){return l.DesignFeatureUtils.sumAreaOfForma(i.clone(e.root_.filterByControllerKind(u.FrameController.KIND)),e.root_)},evaluateShapeDesignCoverage:function(e){var t=i.clone(e.root_.filterWithCallback(function(e){return e instanceof v.ShapeForma&&null!=e.controller&&e.controller.floating}));return l.DesignFeatureUtils.sumAreaOfForma(i.clone(t),e.root_)},evaluateTextCount:function(e){return l.DesignFeatureUtils.getTextCount(e.root_)},evaluateImageCount:function(e){return l.DesignFeatureUtils.getImageCount(e.root_)},evaluateShapeCount:function(e){return l.DesignFeatureUtils.getShapeCount(e.root_)},evaluateLogoCount:function(e){var t=i.clone(e.root_.filterWithCallback(function(e){return null!=e.controller&&e.isLogo()}));return i.toDouble(t.length)},evaluateSalientCoverage:function(e){for(var t=i.clone(e.root_.filterByControllerKind(u.FrameController.KIND)),a=0,r=i.iter(t);!r.done;r.next()){var n,o,l,s=r.value;(n=e.root_.finalFrame)&&(o=i.opt(i.as(s,m.ImageForma),function(e){return e.getFocusRegion()}))&&(l=o.intersectionWith(n))&&(a+=l.area/n.area)}return Math.max(a,1)},evaluateMarginSpace:function(e){var t,a=0,r=i.clone(e.root_.filterByControllerKind(c.GridController.KIND));return r.length>0&&(t=i.as(r[0].controller,c.GridController))&&(a=t.margin),a},evaluateVisualGroupInfo:function(e){return i.toDouble(0)},evaluateFonts:function(e){for(var t=[],a=i.iter(l.DesignFeatureUtils.getLockupsInDesign(e.root_));!a.done;a.next()){var r,n,o=a.value;(r=i.as(o.style,g.LockupStyle))&&(n=r.font)&&t.push(n.fontData.postScriptName)}return t},evaluateTextShapes:function(e){for(var t=[],a=i.iter(l.DesignFeatureUtils.getLockupsInDesign(e.root_));!a.done;a.next()){var r,n=a.value;(r=i.as(n.style,g.LockupStyle))&&t.push(r.backingShapeID)}return t},evaluateColors:function(e){for(var t=[],a=i.clone(e.root_.filterWithCallback(function(e){return e instanceof m.ImageForma})),r=i.iter(a);!r.done;r.next()){var n,o,u=r.value;(n=i.as(u,m.ImageForma))&&(o=i.opt(n.contentNode,function(e){return e.image}))&&i.append(t,o.getImageColors(5))}for(var s=i.iter(l.DesignFeatureUtils.getLockupsInDesign(e.root_));!s.done;s.next()){var c,h,v,f,p=s.value;(c=i.as(p.style,g.LockupStyle))&&((v=e.primaryColorForStyle(c))&&t.push(v),(f=e.secondaryColorForStyle(c))&&t.push(f),(h=c.characterStyles.Highlight)&&((v=e.primaryColorForStyle(h))&&t.push(v),(f=e.secondaryColorForStyle(h))&&t.push(f)))}return t.map(function(e){return e.hex},this)},primaryColorForStyle:function(e){return e.colors.color(o.ColorRole.FieldPrimary)},secondaryColorForStyle:function(e){return e.backing!=g.LockupBacking.None&&e.backing!=g.LockupBacking.UNSET?e.colors.color(o.ColorRole.FieldSecondary):null},evaluateBackgroundTypes:function(e){for(var t=[],a=i.clone(e.root_.filterWithCallback(function(e){return(e.isBackgroundImage()||e.kind==v.ShapeForma.KIND||e.kind==h.RootForma.KIND)&&null!=e.controller&&!e.controller.moveable})),r=i.iter(a);!r.done;r.next()){var n=r.value;n.isBackgroundImage()?t.push("image"):n.kind==v.ShapeForma.KIND?t.push("shape"):t.push("root")}return t},evaluatePageWidth:function(e){return l.DesignFeatureUtils.getPageWidth(e.root_)},evaluatePageHeight:function(e){return l.DesignFeatureUtils.getPageHeight(e.root_)},evaluateGridCount:function(e){return i.toDouble(e.root_.filterWithCallback(function(e){return null!=e.controller&&e.controller.kind==c.GridController.KIND&&e.isGridCell()}).length)},evaluateBackgroundImageCount:function(e){return i.toDouble(e.root_.filterWithCallback(function(e){return null!=e.controller&&e.controller.kind==u.FrameController.KIND&&e.isGridCell()}).length)},evaluateForegroundImageCount:function(e){return i.toDouble(e.root_.filterWithCallback(function(e){return null!=e.controller&&e.controller.kind==u.FrameController.KIND&&!e.isGridCell()}).length)}}}),r)},421:function(e,t,a){var r,n=t,i=a(0),o=a(134),l=a(91),u=a(282),s=a(309),c=a(32),m=a(55),g=a(28),h=a(12);n.LockupStyleFeatureExtractor=(r=function(e,t){void 0===t&&(t=[]),this.root_=e.root,this.forma_=e,this.lockupController_=i.as(this.forma_.controller,h.TypeLockupController),this.forFeatures_=i.clone(t),this.featureEvals_=[],this.lockupAttributes=i.clone(s.lockupStyleToLockupStyleAttributes(this.forma_.style,e.page.document)),l.FeatureExtractor.call(this),null!=this.lockupController_&&(this.initFeatures(),this.evaluateFeatures())},i.defineClass({name:"LockupStyleFeatureExtractor",ctor:r,superName:"FeatureExtractor",statics:{_implements:function(e){return"FeatureExtractorProtocol"==e}},props:{initFeatures:function(){this.featureEvals_=[["Role",[this.evaluateRole,l.FeatureType.Categorical]],["BoundingBox",[this.evaluateBoundingBox,l.FeatureType.Complex]],["BackgroundColors",[this.evaluateBackgroundColors,l.FeatureType.Complex]],["ImageCount",[this.evaluateImageCount,l.FeatureType.Numerical]],["ShapeCount",[this.evaluateShapeCount,l.FeatureType.Numerical]],["TextCount",[this.evaluateTextCount,l.FeatureType.Numerical]],["TextHeight",[this.evaluateTextHeight,l.FeatureType.Numerical]],["TextWidth",[this.evaluateTextWidth,l.FeatureType.Numerical]],["PageHeight",[this.evaluatePageHeight,l.FeatureType.Numerical]],["PageWidth",[this.evaluatePageWidth,l.FeatureType.Numerical]],["AspectRatio",[this.evaluateAspectRatio,l.FeatureType.Numerical]],["BackgroundType",[this.evaluateBackgroundType,l.FeatureType.Categorical]],["AverageHue",[this.evaluateAverageHue,l.FeatureType.Numerical]],["AverageLightness",[this.evaluateLightness,l.FeatureType.Numerical]],["LightnessSpread",[this.evaluateLightnessSpread,l.FeatureType.Numerical]],["PercentageArea",[this.evaluatePercentageArea,l.FeatureType.Numerical]],["PercentageAreaAllLockups",[this.evaluateAllLockPercentageArea,l.FeatureType.Numerical]],["LockupSymmetryX",[this.evaluateXSymmetry,l.FeatureType.Numerical]],["LockupSymmetryY",[this.evaluateYSymmetry,l.FeatureType.Numerical]],["DistanceXFromCenter",[this.evaluateXDistanceFromCenter,l.FeatureType.Numerical]],["TextString",[this.evaluateTextString,l.FeatureType.Categorical]],["CenterX",[this.evaluateCenterX,l.FeatureType.Numerical]],["CenterY",[this.evaluateCenterY,l.FeatureType.Numerical]],["CharacterCount",[this.evaluateCharacterCount,l.FeatureType.Numerical]],["LineHeight",[this.evaluateLineHeight,l.FeatureType.Numerical]],["WordCount",[this.evaluateWordCount,l.FeatureType.Numerical]],["Font",[this.evaluateStyleFont,l.FeatureType.Categorical]],["BackingShape",[this.evaluateStyleBackingShape,l.FeatureType.Categorical]],["TextLook",[this.evaluateStyleTextLook,l.FeatureType.Categorical]],["Layout",[this.evaluateStyleLayout,l.FeatureType.Categorical]],["Opacity",[this.evaluateStyleOpacity,l.FeatureType.Categorical]],["PrimaryColor",[this.evaluateStylePrimaryColor,l.FeatureType.Categorical]],["SecondaryColor",[this.evaluateStyleSecondaryColor,l.FeatureType.Categorical]],["ShapeFilled",[this.evaluateStyleShapeFilled,l.FeatureType.Numerical]],["TextOpacity",[this.evaluateStyleTextOpacity,l.FeatureType.Numerical]],["BackingOpacity",[this.evaluateStyleBackingOpacity,l.FeatureType.Numerical]],["Padding",[this.evaluateStylePadding,l.FeatureType.Numerical]],["ShadowAngle",[this.evaluateStyleShadowAngle,l.FeatureType.Numerical]],["ShadowOffsetY",[this.evaluateStyleShadowOffsetY,l.FeatureType.Numerical]],["Spacing",[this.evaluateStyleSpacing,l.FeatureType.Numerical]],["StrokeWeight",[this.evaluateStyleStokeWeight,l.FeatureType.Numerical]],["Tracking",[this.evaluateStyleTracking,l.FeatureType.Numerical]],["HasMSL",[this.evaluateHasMSL,l.FeatureType.Numerical]]]},evaluateFeatures:function(){for(var e=0==this.forFeatures_.length,t=i.iter(this.featureEvals_);!t.done;t.next()){var a=t.value;if(e||!e&&this.forFeatures_.includes(a[0])){var r=a[1],n=(0,r[0])(this);this.setFeature(a[0],n,r[1])}}},evaluateWordCount:function(e){return i.toDouble(e.lockupController_.wordCount())},evaluateLineHeight:function(e){var t=e.lockupController_.averageLineHeight;return null!=t?t:0},evaluateCharacterCount:function(e){return i.toDouble(e.lockupController_.text.length)},evaluateRole:function(e){return(new m.RoleSuggester).getRole(e.forma_).role},evaluateBoundingBox:function(e){return o.DesignFeatureUtils.getFormaBoundingBox(e.forma_)},evaluateBackgroundColors:function(e){return this.setColorsBehindLockup(e),e.colorsBehindLockup.map(function(e){return e.hex},this)},evaluateImageCount:function(e){return o.DesignFeatureUtils.getImageCount(e.root_)},evaluateShapeCount:function(e){return o.DesignFeatureUtils.getShapeCount(e.root_)},evaluateTextCount:function(e){return o.DesignFeatureUtils.getTextCount(e.root_)},evaluateTextHeight:function(e){return o.DesignFeatureUtils.getFormaHeight(e.forma_)},evaluateTextWidth:function(e){return o.DesignFeatureUtils.getFormaWidth(e.forma_)},evaluateBackgroundType:function(e){for(var t="root",a=i.clone(e.root_.filterWithCallback(function(e){return(e.isBackgroundImage()||e.kind==g.ShapeForma.KIND||e.kind==c.RootForma.KIND)&&null!=e.controller&&!e.controller.moveable})),r=i.iter(a);!r.done;r.next()){var n=r.value;n.isBackgroundImage()&&n.finalFrame.outsetXY(20,20).contains(e.forma_.finalFrame)?t="image":n.kind==g.ShapeForma.KIND&&(t="shape")}return t},evaluateAverageHue:function(e){var t=0,a=0,r=0,n=0;this.setColorsBehindLockup(e);for(var o=i.iter(e.colorsBehindLockup);!o.done;o.next()){var l=o.value.asLAB;t+=l.l*l.l,a+=l.a*l.a,r+=l.b*l.b,n+=l.alpha*l.alpha}var s=i.toDouble(e.colorsBehindLockup.length);return t=Math.sqrt(t/s),a=Math.sqrt(a/s),r=Math.sqrt(r/s),n=Math.sqrt(n/s),new u.LABColor(t,a,r,n).hue},evaluateAspectRatio:function(e){var t=o.DesignFeatureUtils.getFormaHeight(e.forma_),a=o.DesignFeatureUtils.getFormaWidth(e.forma_);return i.toDouble(a/t)},evaluateLightness:function(e){var t=0,a=0,r=0,n=0;this.setColorsBehindLockup(e);for(var o=i.iter(e.colorsBehindLockup);!o.done;o.next()){var l=o.value.asLAB;t+=l.l*l.l,a+=l.a*l.a,r+=l.b*l.b,n+=l.alpha*l.alpha}var s=i.toDouble(e.colorsBehindLockup.length);return t=Math.sqrt(t/s),a=Math.sqrt(a/s),r=Math.sqrt(r/s),n=Math.sqrt(n/s),new u.LABColor(t,a,r,n).asRGB.lightness},evaluateLightnessSpread:function(e){return this.setColorsBehindLockup(e),e.lockupController_.getBackgroundLightnessSpread(i.clone(e.colorsBehindLockup))},evaluatePercentageArea:function(e){return o.DesignFeatureUtils.formaPercentageArea(e.forma_)},evaluateAllLockPercentageArea:function(e){for(var t=0,a=i.clone(e.forma_.page.root.filterWithCallback(function(e){return e.isTypeLockup()})),r=i.iter(a);!r.done;r.next()){var n=r.value;t+=o.DesignFeatureUtils.formaPercentageArea(n)}return t},evaluateXSymmetry:function(e){return o.DesignFeatureUtils.getSymmAsymm([e.forma_.finalFrame],!0)},evaluateYSymmetry:function(e){return o.DesignFeatureUtils.getSymmAsymm([e.forma_.finalFrame],!1)},evaluateXDistanceFromCenter:function(e){var t,a,r=-1;return(t=e.forma_.finalFrame)&&(a=e.root_.finalFrame)&&(r=t.center.distanceTo(a.center)),r},evaluateTextString:function(e){return e.lockupController_.text},evaluateCenterX:function(e){return o.DesignFeatureUtils.getFormaCenterX(e.forma_)},evaluateCenterY:function(e){return o.DesignFeatureUtils.getFormaCenterY(e.forma_)},evaluatePageWidth:function(e){return o.DesignFeatureUtils.getPageWidth(e.root_)},evaluatePageHeight:function(e){return o.DesignFeatureUtils.getPageHeight(e.root_)},evaluateStyleShapeFilled:function(e){return e.forma_.style.textBacked?1:0},evaluateStyleTextOpacity:function(e){return e.lockupAttributes.textOpacity},evaluateStyleBackingOpacity:function(e){return e.lockupAttributes.backingOpacity},evaluateStylePadding:function(e){return e.lockupAttributes.padding},evaluateStyleShadowAngle:function(e){return e.lockupAttributes.shadowAngle},evaluateStyleShadowOffsetY:function(e){return e.lockupAttributes.shadowOffset},evaluateStyleSpacing:function(e){return e.lockupAttributes.spacing},evaluateStyleStokeWeight:function(e){return e.lockupAttributes.strokeWeight},evaluateStyleTracking:function(e){return e.lockupAttributes.tracking},evaluateHasMSL:function(e){var t=i.clone(e.forma_.style.characterStyles);return 0!=i.count(t)?1:0},evaluateStyleFont:function(e){return i.toString(e.lockupAttributes.font)},evaluateStyleBackingShape:function(e){return e.lockupAttributes.backing},evaluateStyleTextLook:function(e){return e.lockupAttributes.textLook},evaluateStyleLayout:function(e){return e.lockupAttributes.layout},evaluateStyleOpacity:function(e){return e.lockupAttributes.opacity},evaluateStylePrimaryColor:function(e){return e.lockupAttributes.primaryColor},evaluateStyleSecondaryColor:function(e){return e.lockupAttributes.secondaryColor},setColorsBehindLockup:function(e){null==e.colorsBehindLockup&&(e.colorsBehindLockup=i.clone(e.lockupController_.getBackgroundColors()))}}}),r)},422:function(e,t,a){var r,n=t,i=a(0),o=a(134),l=a(9),u=a(91),s=a(23),c=a(18),m=a(51),g=a(68),h=a(26),v=a(69),f=a(236);n.RetargetFeatureExtractor=(r=function(e,t){void 0===t&&(t=[]),this.root_=e,this.forFeatures_=i.clone(t),this.featureEvals_=[],u.FeatureExtractor.call(this),this.initFeatures(),this.evaluateFeatures()},i.defineClass({name:"RetargetFeatureExtractor",ctor:r,superName:"FeatureExtractor",statics:{_implements:function(e){return"FeatureExtractorProtocol"==e}},props:{initFeatures:function(){this.featureEvals_=[["Size",[this.evaluateDesignSize,u.FeatureType.Complex]],["EditingResolution",[this.evaluateEditingResolution,u.FeatureType.Numerical]],["PublishResolution",[this.evaluatePublishingResolution,u.FeatureType.Numerical]],["LayoutId",[this.evaluateLayoutId,u.FeatureType.Categorical]],["Edges",[this.evaluateEdges,u.FeatureType.Complex]],["Focus",[this.evaluateFocus,u.FeatureType.Complex]],["NumImages",[this.evaluateImageCount,u.FeatureType.Numerical]],["NumShapes",[this.evaluateShapeCount,u.FeatureType.Numerical]],["NumGridsCells",[this.evaluateGridCellCount,u.FeatureType.Numerical]],["NumMoveable",[this.evaluateNumMoveable,u.FeatureType.Numerical]],["LockupStrings",[this.evaluateLockupStrings,u.FeatureType.Complex]],["VisualGroupInfo",[this.evaluateVisualGroupInfo,u.FeatureType.Complex]],["TextRoles",[this.evaluateTextRoles,u.FeatureType.Complex]],["ShapeRoles",[this.evaluateShapeRoles,u.FeatureType.Complex]],["SalientCoverage",[this.evaluateSalientCoverage,u.FeatureType.Numerical]],["GifsCount",[this.evaluateGifsCount,u.FeatureType.Numerical]]]},evaluateFeatures:function(){for(var e=0==this.forFeatures_.length,t=i.iter(this.featureEvals_);!t.done;t.next()){var a=t.value;if(e||!e&&this.forFeatures_.includes(a[0])){var r=a[1],n=(0,r[0])(this);this.setFeature(a[0],n,r[1])}}},evaluateDesignSize:function(e){var t=[];return t.push(o.DesignFeatureUtils.getPageWidth(e.root_)),t.push(o.DesignFeatureUtils.getPageHeight(e.root_)),t},evaluateEditingResolution:function(e){return 2},evaluatePublishingResolution:function(e){return 2},evaluateLayoutId:function(e){var t="default",a=i.clone(e.root_.filterByControllerKind(s.GridController.KIND));return a.length>0&&(t=i.as(a[0].controller,s.GridController).gridStyle.name),t},evaluateEdges:function(e){var t=[],a=i.clone(e.root_.filterWithCallback(function(e){return e.isBackgroundImage()}));return a.length>0&&(t=i.clone(a[0].controller.getAverageEdgeGrid(new h.TheoSize(5,5)))),t},evaluateFocus:function(e){var t=i.clone(e.root_.filterWithCallback(function(e){return e.isBackgroundImage()})),a=[];if(t.length>0){var r,n=t[0];(r=e.getFocusRegion(n))&&(a=i.clone(r.encodeJson()))}return a},getFocusRegion:function(e){var t=null;return e.visitAll(l.FormaTraversal.JustChildren,function(e){e instanceof c.ImageForma&&null==t&&(t=e.getFocusRegion())}),t},evaluateImageCount:function(e){return o.DesignFeatureUtils.getImageCount(e.root_)},evaluateNumMoveable:function(e){return i.toDouble(e.root_.filterWithCallback(o.DesignFeatureUtils.isFloating).length)},evaluateLockupStrings:function(e){return g.TypeLockupUtils.getLockupStringsForRoot(e.root_)},evaluateTextRoles:function(e){for(var t=[],a=i.clone(o.DesignFeatureUtils.getLockupsInDesign(e.root_)),r=i.iter(a);!r.done;r.next()){var n=r.value;t.push(o.DesignFeatureUtils.getRoleString(n))}return t},evaluateShapeRoles:function(e){for(var t=[],a=i.clone(e.root_.filterWithCallback(function(e){return null!=e.controller&&e.controller.kind==m.ShapeController.KIND&&!e.isGridCell()})),r=i.iter(a);!r.done;r.next()){var n=r.value;t.push(o.DesignFeatureUtils.getRoleString(n))}return t},evaluateShapeCount:function(e){return i.toDouble(e.root_.filterWithCallback(function(e){return null!=e.controller&&e.controller.kind==m.ShapeController.KIND&&!e.isGridCell()}).length)},evaluateSalientCoverage:function(e){for(var t=i.clone(e.root_.filterWithCallback(function(e){return e.isBackgroundImage()})),a=0,r=i.iter(t);!r.done;r.next()){var n,o,l,u=r.value;(n=e.root_.finalFrame)&&(o=e.getFocusRegion(u))&&(l=o.intersectionWith(n))&&(a+=l.area/n.area)}return a},evaluateVisualGroupInfo:function(e){var t={},a=i.clone(e.root_.filterWithCallback(function(e){return null!=e.controller&&e.controller.floating&&!e.isGridCell()&&e.kind!=c.ImageForma.KIND}));return a.length>0&&new f.VisualStructureDetector(i.clone(a),e.root_).inferVisualStructure().encodeToJson()||t},evaluateGridCellCount:function(e){return i.toDouble(e.root_.filterWithCallback(function(e){return null!=e.controller&&e.isGridCell()}).length)},evaluateGifsCount:function(e){var t=i.clone(e.root_.filterWithCallback(function(e){return e.kind==v.VideoForma.KIND}));return i.toDouble(t.length)}}}),r)},423:function(e,t,a){var r,n=t,i=a(0),o=a(134),l=a(9),u=a(24),s=a(91),c=a(424),m=a(235);n.ShapeFeatureExtractor=(r=function(e,t){void 0===t&&(t=[]),this.root_=e.root,this.forma_=e,this.forFeatures_=i.clone(t),this.featureEvals_=[],s.FeatureExtractor.call(this),this.initFeatures(),this.evaluateFeatures()},i.defineClass({name:"ShapeFeatureExtractor",ctor:r,superName:"FeatureExtractor",statics:{_implements:function(e){return"FeatureExtractorProtocol"==e}},props:{initFeatures:function(){this.featureEvals_=[["BoundingBox",[this.evaluateBoundingBox,s.FeatureType.Complex]],["ShapeWidth",[this.evaluateShapeWidth,s.FeatureType.Numerical]],["ShapeHeight",[this.evaluateShapeHeight,s.FeatureType.Numerical]],["Area",[this.evaluateArea,s.FeatureType.Numerical]],["CenterX",[this.evaluateCenterX,s.FeatureType.Numerical]],["CenterY",[this.evaluateCenterY,s.FeatureType.Numerical]],["RotCosine",[this.evaluateRotCosine,s.FeatureType.Numerical]],["RotSine",[this.evaluateRotSine,s.FeatureType.Numerical]],["PercentageDesignArea",[this.evaluatePercentageDesignArea,s.FeatureType.Numerical]],["PercentageOutofBounds",[this.evaluatePercentageOutofBounds,s.FeatureType.Numerical]],["PageHeight",[this.evaluatePageHeight,s.FeatureType.Numerical]],["PageWidth",[this.evaluatePageWidth,s.FeatureType.Numerical]],["ShapeCount",[this.evaluateShapeCount,s.FeatureType.Numerical]],["TextCount",[this.evaluateTextCount,s.FeatureType.Numerical]],["BackgroundImageCount",[this.evaluateBackgroundImageCount,s.FeatureType.Numerical]],["ForegroundImageCount",[this.evaluateForegroundImageCount,s.FeatureType.Numerical]]],this.evaluateOverlappingFeatures(),this.evaluateShapeMaskFeatures()},evaluateOverlappingFeatures:function(){for(var e=i.clone(this.root_.visitAsArray(l.FormaTraversal.PreOrder)),t=0,a=0,r=0,n=0,o=i.iter(e);!o.done;o.next()){var u=o.value;if(null!=u.controller&&u.controller.floating&&!u.isGridCell()&&"temp-struct-vis"!=u.intent&&u!=this.forma_){if(u.parent==this.forma_.parent){var c=this.forma_.parent.indexOfChild(this.forma_),m=this.forma_.parent.indexOfChild(u);if(null!=c&&null!=m&&c>m)continue}var g,h,v;if((g=u.finalFrame)&&(h=this.forma_.finalFrame)&&(v=g.intersectionWith(h))){var f=this.forma_.getAverageAlpha(g),p=v.area/h.area;f>.01&&p>.05&&(u.isTypeLockup()?(a+=1,r+=f*p):(t+=1,n+=f*p))}}}this.setFeature("OverlappingGraphicCount",t,s.FeatureType.Numerical),this.setFeature("OverlappingTextCount",a,s.FeatureType.Numerical),this.setFeature("PercentageTextOverlap",r,s.FeatureType.Numerical),this.setFeature("PercentageGraphicOverlap",n,s.FeatureType.Numerical)},evaluateShapeMaskFeatures:function(){var e,t=0,a=0;if((e=this.forma_.maskImage)&&!e.isEmpty()){var r=c.ImageProcessingUtils.getEdgeMagnitudeImage(e);t=e.sum()/i.toDouble(e.numElements),a=r.sum()/i.toDouble(e.numElements)}this.setFeature(m.ShapeRoleFeatures.MaskAverage,t,s.FeatureType.Numerical),this.setFeature(m.ShapeRoleFeatures.MaskAverageEdge,a,s.FeatureType.Numerical)},evaluateFeatures:function(){for(var e=0==this.forFeatures_.length,t=i.iter(this.featureEvals_);!t.done;t.next()){var a=t.value;if(e||!e&&this.forFeatures_.includes(a[0])){var r=a[1],n=(0,r[0])(this);this.setFeature(a[0],n,r[1])}}},evaluateBoundingBox:function(e){return o.DesignFeatureUtils.getFormaBoundingBox(e.forma_)},evaluateShapeWidth:function(e){return o.DesignFeatureUtils.getFormaWidth(e.forma_)},evaluateShapeHeight:function(e){return o.DesignFeatureUtils.getFormaHeight(e.forma_)},evaluateArea:function(e){return e.numericalFeatures_.ShapeWidth*e.numericalFeatures_.ShapeHeight},evaluateCenterX:function(e){return o.DesignFeatureUtils.getFormaCenterX(e.forma_)},evaluateCenterY:function(e){return o.DesignFeatureUtils.getFormaCenterY(e.forma_)},evaluateRotCosine:function(e){return e.forma_.totalPlacement.transformValues.rotCosine},evaluateRotSine:function(e){return e.forma_.totalPlacement.transformValues.rotSine},evaluatePercentageDesignArea:function(e){var t=e.root_.finalFrame.area;return e.numericalFeatures_.Area/t},evaluatePercentageOutofBounds:function(e){var t,a,r=0;return(t=e.forma_.finalFrame)&&(a=e.root_.finalFrame.intersectionWith(t))&&(r=(t.area-a.area)/t.area),r},evaluateOverlappingGraphicCount:function(e){var t,a,r=0;return(t=e.forma_.finalFrame)&&(a=e.root_.finalFrame.intersectionWith(t))&&(r=(t.area-a.area)/t.area),r},evaluateShapeCount:function(e){return o.DesignFeatureUtils.getShapeCount(e.root_)},evaluateTextCount:function(e){return o.DesignFeatureUtils.getTextCount(e.root_)},evaluatePageWidth:function(e){return o.DesignFeatureUtils.getPageWidth(e.root_)},evaluatePageHeight:function(e){return o.DesignFeatureUtils.getPageHeight(e.root_)},evaluateBackgroundImageCount:function(e){return i.toDouble(e.root_.filterWithCallback(function(e){return null!=e.controller&&e.controller.kind==u.FrameController.KIND&&e.isGridCell()}).length)},evaluateForegroundImageCount:function(e){return i.toDouble(e.root_.filterWithCallback(function(e){return null!=e.controller&&e.controller.kind==u.FrameController.KIND&&!e.isGridCell()}).length)}}}),r)},572:function(e,t,a){var r,n=t,i=a(0),o=a(3),l=a(226),u=a(296);n.GridLearning=(r=function(){o.CoreObject.call(this)},i.defineClass({name:"GridLearning",ctor:r,superName:"CoreObject",statics:{learnGridMappingWeights:function(e){if(0==e.length)return{weights:[],bestStyle:null};for(var t={},a=i.iter(e);!a.done;a.next()){var n=a.value,o=new l.GridScore(n.gridStyle,n.gridFrame,i.clone(n.layoutItems));t[n.docID]={score:o,features:o.getFeatures()}}for(var u=new l.GridScore(e[0].gridStyle,e[0].gridFrame,i.clone(e[0].layoutItems)),s=i.clone(u.getWeights()),c=null,m=i.iter(i.range(0,500,!1));!m.done;m.next()){for(var g=m.value,h=i.repeat(0,s.length),v=0,f=0,p=null,d=0,F=i.iter(e);!F.done;F.next()){var y,C=t[(n=F.value).docID];if(C.score.setWeights(i.clone(s)),y=r.getBestGridLayout(i.clone(n),i.clone(s))){p=y.gridStyle,v+=C.score.score,f+=y.score;for(var x=i.clone(y.getFeatures()),T=i.iter(i.range(0,s.length,!1));!T.done;T.next())h[_=T.value]+=x[_]-C.features[_];d+=1}}if(v/=i.toDouble(e.length),f/=i.toDouble(e.length),i.info(i.toString("\nNIO iteration "+g+" G: %5.02f fInit: %5.02f fOpt: %5.02f avg mismatch %5.02f",f-v,v,f)),f-v<.001){c=p;break}for(var S=i.iter(i.range(0,s.length,!1));!S.done;S.next()){var _,A=h[_=S.value]/i.toDouble(d);s[_]+=-1*A*.01}}return{weights:s,bestStyle:c}},getBestGridLayout:function(e,t){var a=i.clone(u.LayoutSuggester.init_5613(i.clone(e),null,i.clone(t)).createSuggestions());return 0==!a.length?a[0].weightedScore:null}}}),r)},91:function(e,t,a){var r,n,i=t,o=a(0),l=a(297),u=a(420),s=a(22),c=a(227),m=a(421),g=a(422),h=a(423);i.FeatureExtractorProtocol=o.defineProtocol("FeatureExtractorProtocol",{features:"Dictionary<String>",numericalFeatures:"Dictionary<String>",categoricalFeatures:"Dictionary<String>"}),i.FeatureExtractor=(r=function(){this.numericalFeatures_={},this.categoricalFeatures_={},this.complexFeatures_={},this.allFeatures_={}},o.defineClass({name:"FeatureExtractor",ctor:r,statics:{_implements:function(e){return"FeatureExtractorProtocol"==e}},props:{setFeature:function(e,t,a){a==i.FeatureType.Categorical?this.categoricalFeatures_[e]=o.as(t,"String"):a==i.FeatureType.Numerical?this.numericalFeatures_[e]=o.as(t,"Double"):this.complexFeatures_[e]=t,this.allFeatures_[e]=t},getFeature:function(e){return this.allFeatures_[e]},features:{get:function(){return this.allFeatures_}},numericalFeatures:{get:function(){return this.numericalFeatures_}},categoricalFeatures:{get:function(){return this.categoricalFeatures_}},featureForKey:function(e){return null!=this.features[e]?this.features[e]:null},numericFeatureForKey:function(e){return null!=this.numericalFeatures[e]?this.numericalFeatures[e]:null},categoricalFeatureForKey:function(e){return null!=this.categoricalFeatures_[e]?this.categoricalFeatures_[e]:null}}}),r),i.FeatureExtractorFactory=(n=function(){},o.defineClass({name:"FeatureExtractorFactory",ctor:n,statics:{getFeatureExtractor:function(e,t,a){switch(void 0===a&&(a=[]),e){case 0:return new u.DesignStyleFeatureExtractor(t,o.clone(a));case 1:return new m.LockupStyleFeatureExtractor(t,o.clone(a));case 2:return new c.GridStyleFeatureExtractor(o.as(t,s.GroupForma),void 0,void 0,void 0,o.clone(a));case 3:return new l.DesignConstraintFeatureExtractor(t,o.clone(a));case 4:return new h.ShapeFeatureExtractor(t,o.clone(a));case 5:return new g.RetargetFeatureExtractor(t,o.clone(a))}}}}),n),i.FeatureExtractorType=o.defineEnum("FeatureExtractorType",{DesignStyle:0,LockupStyle:1,GridStyle:2,DesignConstraint:3,Shape:4,Retarget:5}),i.FeatureType=o.defineEnum("FeatureType",{Numerical:0,Categorical:1,Complex:2})}}]);
//# sourceMappingURL=logomaker-entry_4b7e3185-5772176d.js.map